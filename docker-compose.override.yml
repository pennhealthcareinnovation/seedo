# Override the standard production docker-compose.yml with local development settings
# https://docs.docker.com/compose/extends/#multiple-compose-files

version: '3.8'
services:
  server:
    image: seedo/server:latest
    build:
      context: .
      dockerfile: ./server/Dockerfile
      target: development
    ports:
      - target: ${SERVER_PORT}
        published: ${SERVER_PORT}
        protocol: tcp
        mode: host
      - target: 9229
        published: 9229
        protocol: tcp
        mode: host
    env_file:
      - ./.env
    # environment:
    #   - AUTH_DISABLED=true
    volumes:
      # - /server/node_modules
      - .:/app
    tty: true
    stdin_open: true
  
  web:
    image: seedo/web:latest
    build:
      context: .
      dockerfile: ./web/Dockerfile
      target: development
    ports:
      - target: ${WEB_PORT}
        published: ${WEB_PORT}
        protocol: tcp
        mode: host
    env_file:
      - ./.env
    volumes:
      # - /web/node_modules
      - .:/web
    tty: true
    stdin_open: true

  # database:
  #   image: postgres:14.2
  #   ports: 
  #     - 5432:5432
  #   env_file:
  #     - ./.env
  #   volumes:
  #     - ./db:/var/lib/postgresql/data
  #   tty: true
  #   stdin_open: true

  function-deploy:
    image: uphschcich.azurecr.io/seedo-function-deploy:latest
    profiles: ["function-deploy"] # exclude this from routine runs, only used for function deployment
    build:
      context: .
      dockerfile: ./function/Dockerfile
      target: deploy
    env_file:
      - ./.env
    tty: true
    stdin_open: true

networks:
  default:
    driver: bridge